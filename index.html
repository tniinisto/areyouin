<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">

<!-- disable iPhone inital scale -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

<title>R'YouIN</title>
<meta name="keywords" content="events, participants, team, group">
<meta name="description" content="Event management and participation">

<!-- main css -->
<link href="style.css" rel="stylesheet" type="text/css">

<!-- media queries css -->
<link href="media-queries.css" rel="stylesheet" type="text/css">

<!-- Scripts -->
<script type="text/javascript" charset="utf-8" src="main.js"> </script>
<script src="js/iscroll.js"></script>
<script src="https://maps.googleapis.com/maps/api/js"></script>

<!--JQuery -->
<!--<script src="http://code.jquery.com/jquery-2.0.0.min.js"></script>-->
<script src="js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="js/jquery.form.min.js"></script>
<script type="text/javascript" src="js/scrollintoview.js"></script>
<script type="text/javascript" src="js/spin.min.js"></script>

<!--Snowing disabled testing version control-->
<script type="text/javascript" src="js/jquery.snow.js"></script>

<script>
    var scroll; //Chat
    //var scroll2; //User list
    //$("#chatdiv").on("show", function () {
    //    alert("#chatdiv is now shown");
    //    scroll.refresh();
    //});
</script>

<!-- html5.js for IE less than 9 -->
<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- css3-mediaqueries.js for IE less than 9 -->
<!--[if lt IE 9]>
	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<![endif]-->

<!--<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50815012-1', 'areyouin.azurewebsites.net');
  ga('send', 'pageview');

</script>-->

<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">


<!-- load Google chart AJAX API -->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    //Charts datatable
    var dataTable;

    //load the Google Visualization API and the chart
    //google.load('visualization', '1', { 'packages': ['columnchart'] });
    google.load('visualization', '1', { 'packages': ['corechart'] });

    //set callback
    //google.setOnLoadCallback(createChart);

    //Draw on window resize, don't animate
    $(window).resize(function () {
        createChart(0);
    });

</script>
<!-- load Google chart AJAX API -->

<!--Google Maps-->
<!--<script>
    google.maps.event.addDomListener(window, 'load', initializeMap);
</script>-->

</head>


<body>

<div id="pagewrap" class="rain">

	<header id="header">

		<hgroup>
			<h1 id="site-logo"><a href="">R'YouIN</a></h1>
			<h6 id="userlogin1">Welcome</h6>
		</hgroup>

		<nav>
			<ul id="main-nav" class="clearfix">
				<li id="linkgames" class="current"><a href="#">Events</a></li> <!--Simple & clear list on games for player -->
                <li id="linkchat" onclick="refreshScroll(); updateLastMsgTime();"><a href="#">Chat<img id="msg_icon" class="msg_icon_style noshow" alt="New messages" src="images/new_chat.png"></img></a></li>  
                <li id="linkprofile"><a href="#">Profile</a></li>
                <li id="linkadmin"></li>
                
                <!--<li id="nav_logout" style="float: right;"><a href="http://areyouin.azurewebsites.net/" onclick="logout.php"><span style="color:red">Logout</span></a></li>-->
                <!--<li id="nav_logout" style="float: right;"><a href="http://areyouin.azurewebsites.net/" onclick="logout.php">Logout</a></li>-->
                
                <li id="nav_logout" style="float: right; padding-right: 10px;"><a href="#" onclick="toLoginPage(); logout();">Logout</a></li>
			</ul>
		</nav>

	</header>
		
	<!-- #content -->

    <div id="spinner_id"></div>

	<div id="event_content_id" class="content">
		<article class="clearfix" onClick="getEvents()">
			<!--<h2>Games</h2>-->
		</article>
	</div>

    <div id="profile_content_id" class="content noshow">
        <article class="clearfix">
            <!--<h2>Profile</h2>-->
        </article>
    </div>

    <div id="chat_content_id" class="content noshow">
        <article class="clearfix">
            <!--<h3 style="text-align: center;">Chat closed...</h3>-->
        </article>
    </div>   

    <div id="admin_content_id" class="content noshow">
        <article class="clearfix">
            <h2>Admin</h2>
        </article>
    </div>           
   	
    <!-- /#content --> 

	<!-- #sidebar -->
    <!--<aside id="weather_content_id" class="sidebar"></aside>-->
    
    <aside id="sidebar1" class="sidebar">

        <section id="playerwidget" class="widget">
                <h2 class="widgettitle" onClick="">Activity</h2>                
                <div id="GamesAmount" class="widgettitle"></div>            
        </section>

    </aside>
    <!-- /#sidebar -->

	<!-- #footer --> 	
	<footer id="footer">
	
		<p>Made by TN &copy <a href="https://maps.google.fi/maps?q=60.413778,+23.155468&hl=en&sll=60.413778,23.155468&sspn=0.002108,0.004367&t=h&z=16" target="_blank">Puonti </a></p>

	</footer>
	<!-- /#footer --> 
	
</div>
<!-- /#pagewrap -->

<!-- scripts -->
<script>

    //Logout
    function logout() {
        $.get("logout.php");
    }

    //Document ready
    jQuery(document).ready(function () {

        //Loader gif
        //$.ajaxSetup({
        //    beforeSend:function(){
        //        // show gif here, eg:
        //        $("#loading").show();
        //    },
        //    complete:function(){
        //        // hide gif here, eg:
        //        $("#loading").hide();
        //    }
        //});

        //Seasons rains...
        //var year = new Date().getFullYear();
        //if (new Date() >= new Date(year + '-11-01')) {
        //    //Winter season :)
        //    $.fn.snow({ minSize: 5, maxSize: 50, newOn: 1000, flakeColor: '#FFFFFF' });
        //}

        //Init functions

        //Spinner
        initSpinner();
        startSpinner();

        //getLoginInformation();
        getPlayerStats();

        //Start session checking
        CheckForSession();

        getEvents();

        getPlayersInsert();
        getAdminStatus();
        getPlayerProfile();
        getChat();

        //Comet for chat
        waitForChat();

        //Comet for events, affected the whole usability too much, needs more investigation!
        //setTimeout('waitForEventUpdate()', 60000); //1 minute
        //setTimeout('waitForEventUpdate()', 1000); //1 second

        //Stop spinner after events have been load
        stopSpinner();

        //getWeather();

        //Events update. 10 minute interval, start after 5 minutes
        setTimeout(function () {
            //do what you need here
            //alert("start async fetch...");
            //setInterval(getEventsAsync(), 60000);
            setInterval(function() {getEventsAsync(); }, 300000);
        }, 300000); // 5 minutes before start

        //Chat new message form/////////////////////////////////
        $("#newChatImg").click(function (event) {
            $("#chat_new_id").toggleClass("clicked");
            //alert("test");
        });

        //Main navigation///////////////////////////////////////
        $("#linkgames").click(function (event) {
            $("#main-nav").children().removeClass("current");
            $("#linkgames").addClass("current");
        });

        $("#linkprofile").click(function (event) {
            $("#main-nav").children().removeClass("current");
            $("#linkprofile").addClass("current");
        });

        $("#linkchat").click(function (event) {
            $("#main-nav").children().removeClass("current");
            $("#linkchat").addClass("current");
        });

        $("#linkadmin").click(function (event) {
            $("#main-nav").children().removeClass("current");
            $("#linkadmin").addClass("current");
        });
        //Main navigation///////////////////////////////////////


        //Admin navigation///////////////////////////////////////
        $("#link_admingame").click(function (event) {
            $("#admin-nav").children().removeClass("current2");
            $("#link_admingame").addClass("current2");
        });

        $("#link_adminsettings").click(function (event) {
            $("#admin-nav").children().removeClass("current2");
            $("#link_adminsettings").addClass("current2");
        });

        $("#link_adminmembers").click(function (event) {
            $("#admin-nav").children().removeClass("current2");
            $("#link_adminmembers").addClass("current2");
        });
        //Admin navigation///////////////////////////////////////


        //Profile navigation///////////////////////////////////////
        $("#link_profile_profile").click(function (event) {
            $("#profile-nav").children().removeClass("current2");
            $("#link_profile_profile").addClass("current2");
        });

        $("#link_profile_chart").click(function (event) {
            $("#profile-nav").children().removeClass("current2");
            $("#link_profile_chart").addClass("current2");
        });
        //Profile navigation///////////////////////////////////////


        //Image upload/////////////////////////////////////////////
        $('#progressbox').hide();

        var options = {
            target: '#output',   // target element(s) to be updated with server response 
            beforeSubmit: beforeSubmit,  // pre-submit callback 
            success: afterSuccess,  // post-submit callback 
            uploadProgress: OnProgress, //upload progress callback 
            resetForm: true        // reset the form after successful submit 
        };

        $('#MyUploadForm').submit(function () {
            //alert("ajax");
            $(this).ajaxSubmit(options);
            // always return false to prevent standard browser submit and page navigation 
            return false;
        });


        //function after succesful file upload (when server response)
        function afterSuccess() {
            $('#submit-btn').show(); //hide submit button
            $('#loading-img').hide(); //hide submit button
            $('#progressbox').delay(1000).fadeOut(); //hide progress bar

            //Update event list & admin content with the new picture
            getEvents();
            getPlayersInsert();
        }

        //function to check file size before uploading.
        function beforeSubmit() {
            //check whether browser fully supports all File API
            if (window.File && window.FileReader && window.FileList && window.Blob) {

                if (!$('#FileInput').val()) //check empty input filed
                {
                    $("#output").html("You must select a file for upload");
                    return false
                }

                var fsize = $('#FileInput')[0].files[0].size; //get file size
                var ftype = $('#FileInput')[0].files[0].type; // get file type


                //allow file types 
                switch (ftype) {
                    case 'image/png':
                    case 'image/gif':
                    case 'image/jpeg':
                    case 'image/JPG':
                    case 'image/pjpeg':
                    case 'text/plain':
                    case 'text/html':
                    case 'application/x-zip-compressed':
                    case 'application/pdf':
                    case 'application/msword':
                    case 'application/vnd.ms-excel':
                    case 'video/mp4':
                        break;
                    default:
                        $("#output").html("<b>" + ftype + "</b> Unsupported file type!");
                        return false
                }

                //Allowed file size is less than 5 MB (5048576)
                if (fsize > 2042880) {
                    $("#output").html("<b>" + bytesToSize(fsize) + "</b> Too big file! <br />File is too big, it should be less than 2 MB.");
                    return false
                }

                $('#submit-btn').hide(); //hide submit button
                $('#loading-img').show(); //hide submit button
                $("#output").html("");
            }
            else {
                //Output error to older unsupported browsers that doesn't support HTML5 File API
                $("#output").html("Please upgrade your browser, because your current browser lacks some new features we need!");
                return false;
            }
        }

        //progress bar function
        function OnProgress(event, position, total, percentComplete) {
            //Progress bar
            $('#progressbox').show();
            $('#progressbar').width(percentComplete + '%') //update progressbar percent complete
            $('#statustxt').html(percentComplete + '%'); //update status text
            if (percentComplete > 50) {
                $('#statustxt').css('color', '#000'); //change status text to white after 50%
            }
        }

        //function to format bites bit.ly/19yoIPO
        function bytesToSize(bytes) {
            var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            if (bytes == 0) return '0 Bytes';
            var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];
        }

    });


    //Main navigation - Content for the selected page///////////
    $("#main-nav").click(function () {
        //alert("Handler for .click() called.");
        //Games
        if ($("#linkgames").hasClass('current')) {
            $("#event_content_id").removeClass("noshow");
            $("#profile_content_id").addClass("noshow");
            $("#chat_content_id").addClass("noshow");
            $("#admin_content_id").addClass("noshow");
            $("#playerwidget").removeClass("noshow");
        }
        //Profile
        if ($("#linkprofile").hasClass('current')) {
            $("#event_content_id").addClass("noshow");
            $("#profile_content_id").removeClass("noshow");
            $("#chat_content_id").addClass("noshow");
            $("#admin_content_id").addClass("noshow");
            $("#playerwidget").removeClass("noshow");
        }

        //Chat
        if ($("#linkchat").hasClass('current')) {
            $("#event_content_id").addClass("noshow");
            $("#profile_content_id").addClass("noshow");
            $("#chat_content_id").removeClass("noshow");
            $("#admin_content_id").addClass("noshow");
            $("#playerwidget").removeClass("noshow");
        }

        //Admin
        if ($("#linkadmin").hasClass('current')) {
            $("#event_content_id").addClass("noshow");
            $("#profile_content_id").addClass("noshow");
            $("#chat_content_id").addClass("noshow");
            $("#playerwidget").addClass("noshow");
            $("#admin_content_id").removeClass("noshow");
        }
    });
    //Main navigation - Content for the selected page///////////

    //Admin navigation - Content for the selected page///////////
    function adminClick() {
        //alert("Handler for admin navigation .click() called.");
        //Games
        if ($("#link_admingame").hasClass('current2')) {
            $("#newgame_id").removeClass("noshow");
            $("#team_content_id").addClass("noshow");
            $("#member_content_id").addClass("noshow");
        }

        if ($("#link_adminsettings").hasClass('current2')) {
            $("#newgame_id").addClass("noshow");
            $("#team_content_id").removeClass("noshow");
            $("#member_content_id").addClass("noshow");
        }

        if ($("#link_adminmembers").hasClass('current2')) {
            $("#newgame_id").addClass("noshow");
            $("#team_content_id").addClass("noshow");
            $("#member_content_id").removeClass("noshow");
        }
    };
    //Admin navigation - Content for the selected page///////////

    //Profile navigation - Content for the selected page///////////
    function profileClick() {

        if ($("#link_profile_profile").hasClass('current2')) {
            $("#profile_profile_content_id").removeClass("noshow");
            $("#profile_chart_content_id").addClass("noshow");
        }

        if ($("#link_profile_chart").hasClass('current2')) {
            $("#profile_profile_content_id").addClass("noshow");
            $("#profile_chart_content_id").removeClass("noshow");
        }
    };
    //Profile navigation - Content for the selected page///////////

    function refreshPlayerInfo() {
        var name = document.getElementById("dialog_player_name").value;
        document.getElementById("profile_playerName").innerHTML = "Nickname: " + name;

        var first = document.getElementById("dialog_player_firstname").value;
        document.getElementById("profile_playerFirstname").innerHTML = "Firstname: " + first;

        var last = document.getElementById("dialog_player_lastname").value;
        document.getElementById("profile_playerLastname").innerHTML = "Lastname: " + last;

        var email = document.getElementById("dialog_player_email").value;
        document.getElementById("profile_playerEmail").innerHTML = "Email: " + email;

        var phone = document.getElementById("dialog_player_phone").value;
        document.getElementById("profile_playerPhone").innerHTML = "Phone: " + phone;

        var notify = document.getElementById("dialog_notify_switch").checked; //true, false       

        if (notify == 0)
            document.getElementById("profile_playerNotify").innerHTML = "Mail notifications: OFF";
        else
            document.getElementById("profile_playerNotify").innerHTML = "Mail notifications: ON";

        window.location.replace('#close');
    };

    //Password change////////////////////////////////////
    function refreshPassword() {
        window.location.replace('#close');
        $("#password_info_id").removeClass('noshow');
        setTimeout(hidePassNotitification, 3000);
    }

    function hidePassNotitification() {
        $("#password_info_id").addClass('noshow');
    }
    //Password change////////////////////////////////////

</script>
<!-- /scripts -->

<!--Get player info and save to session storage-->
<script src="json/playerinfo.js"></script> 

<!--Get chart data-->
<script src="json/chartdata.js"></script> 


</body>
</html>
